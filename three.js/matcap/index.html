<html>
<head>
	<meta charset="UTF-8" />
	<title>üíç</title>
	<style>
		body { margin: 0; overflow: hidden; background-color: #010; }
		#progress { position: absolute; top: 60%; left: 20%; right: 20%; height: 5px; background-color: rgba(200,200,100,0.2); }
		#progress div { width: 1%; height: 100%; background-color: #37f; }
	</style>
</head>
<body>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r79/three.js"></script>

	<script src="OBJLoader.js"></script>
	<script src="OrbitControls.js"></script>
	<script src="load.js"></script>

	<script src="matcap.js"></script>
	<script src="diamond.js"></script>

	<div id="progress"><div></div></div>

	<script>

	function onReady () {
		document.getElementById ('progress').style.display = 'none';
		obj.dispatchEvent ({ type: 'render' });
	}

	function assignMaterials (object) {
		if (object.material) {
			if (object.name == 'Ring') {
				object.material = makeMatCapMaterial ('gold.jpg');
			} else {
				object.geometry.computeVertexNormals ();
				object.material = makeDiamondMaterial ();
				object.material.shading = THREE.FlatShading;
			}
			object.material.addEventListener ('ready', onReady);
		}

		if (object.type == 'PerspectiveCamera') {
			object.position.z *= -1;
			object.position.y = object.position.z * 0.6;
			object.position.x = object.position.z * 0.27;
			object.lookAt (new THREE.Vector3);
		}
	}

	var obj = loadFile ('ring.obj', assignMaterials, document.body);

	obj.addEventListener ('progress', function (event) {
		document.querySelector ('#progress div').style.width = Math.round (100 * event.loaded / event.total) + '%';
	});

	obj.addEventListener ('ready', function () {

		var resize = function () {
			obj.dispatchEvent ({
				type: 'resize', width: window.innerWidth, height: window.innerHeight
			});
		};

		window.addEventListener ('resize', resize);
		resize ();
	});

	</script>
</body>
</html>